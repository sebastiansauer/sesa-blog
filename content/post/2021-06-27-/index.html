---
title: 'Estimating the exponential growth rate approximating a linear function'
author: Sebastian Sauer
date: '2021-06-27'
slug: ''
categories:
  - rstats
tags:
  - math
  - musings
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code>library(tidyverse)
library(scales)</code></pre>
<div id="exponential-growth" class="section level1">
<h1>Exponential growth</h1>
<p>Exponential growth, that is something that is growing relative to its science, hence ubuiquitious in nature, is conveniently and elegantly described by the growth constant <span class="math inline">\(e\)</span>:</p>
<p><span class="math display">\[y = e^{\lambda x}\]</span></p>
<p>And its graph is this for <span class="math inline">\(\lambda=1\)</span>:</p>
<pre class="r"><code>p0 &lt;- ggplot(data.frame(x = seq(from = 0, 
                                to = 3,
                                by = .1))) +
  aes(x = x) +
  theme_minimal()

p0 +
  stat_function(fun = ~ exp(.x))</code></pre>
<p><img src="unnamed-chunk-2-1.png" width="480" /></p>
<p><code>exp(x)</code> does nothing more than computing <span class="math inline">\(e^x\)</span>, where <span class="math inline">\(e \approx 2.7182...\)</span>.</p>
<pre class="r"><code>e &lt;- exp(1)
e</code></pre>
<pre><code>## [1] 2.718282</code></pre>
</div>
<div id="approximating-a-linear-function-with-a-constant-lambda" class="section level1">
<h1>Approximating a linear function with a constant <span class="math inline">\(\lambda\)</span></h1>
<p>The exponential function can also be used to mirror or approximate a linear function with a constant <span class="math inline">\(\lambda\)</span>, which may sound weird, but it is possible for at least some range of the linear function:</p>
<p><span class="math display">\[y = exp(0.1 * x)\]</span></p>
<pre class="r"><code>p0 +
  stat_function(fun = ~ exp(0.1 * .x)) +
  scale_x_continuous(limits = c(0, 3)) +
  geom_abline(slope = 0.1,
              intercept = 1,
              color = &quot;red&quot;,
              alpha = .6,
              size = 2)</code></pre>
<p><img src="unnamed-chunk-4-1.png" width="480" /></p>
<p>For <em>some limited range</em> we can closely approximate the exponential function.</p>
</div>
<div id="close-mirroring-of-the-linear-function" class="section level1">
<h1>Close mirroring of the linear function</h1>
<p>We can make use of the following equality:</p>
<p><span class="math display">\[x = e^{(\text{ln} x)}\]</span></p>
<p>Assume the linear function to be approximated is</p>
<p><span class="math display">\[y = 0.1\cdot x + 1\]</span></p>
<p>Then we have:</p>
<p><span class="math display">\[y = e^{\text{ln}(0.1x + 1)}.\]</span></p>
<p>In R:</p>
<pre class="r"><code>f &lt;- function(x) exp(log(0.1*x + 1))</code></pre>
<p>For example:</p>
<pre class="r"><code>x &lt;- c(-3:10)
f(x)</code></pre>
<pre><code>##  [1] 0.7 0.8 0.9 1.0 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2.0</code></pre>
<p>We need to remember that negative numbers are not defined for the log.</p>
<p>As a diagram:</p>
<pre class="r"><code>p0 +
  stat_function(fun = f) +
  scale_x_continuous(limits = c(0, 3)) +
  geom_abline(slope = 0.1,
              intercept = 1,
              color = &quot;red&quot;,
              alpha = .6,
              size = 2) +
  scale_y_continuous(limits = c(0, 5))</code></pre>
<p><img src="unnamed-chunk-7-1.png" width="480" /></p>
<p>It is not neccessarily an disadvantage that we cannot model/mirror negative x values using this approach as growth processes only feature positive values.</p>
</div>
<div id="simulate-some-data" class="section level1">
<h1>Simulate some data</h1>
<div id="linear-model" class="section level2">
<h2>Linear model</h2>
<p>Here’s a simple linear model, <span class="math inline">\(y \sim x+1\)</span>.</p>
<pre class="r"><code>d &lt;- 
  tibble(
    x = rep(seq(from = 0.1, to = 10, by = .1), 10),
    e = rnorm(n = length(x), sd = .1),  # error term
    y = x + 1,
    y_obs = y + e)</code></pre>
<p>Plot it:</p>
<pre class="r"><code>ggplot(d) +
  aes(x = x, y = y_obs) +  
  geom_point() +
  geom_smooth(method = &quot;lm&quot;)</code></pre>
<p><img src="unnamed-chunk-9-1.png" width="480" /></p>
</div>
<div id="exponential-data" class="section level2">
<h2>Exponential data</h2>
<p>In contrast, consider this exponential function:</p>
<pre class="r"><code>d &lt;- 
  tibble(
    x = rep(seq(from = 0.1, to = 10, by = .1), 10),
    err = rnorm(n = length(x), sd = .1),  # error term
    y = exp(0.1*x),
    y_obs = y + err)</code></pre>
<p>Plot it:</p>
<pre class="r"><code>ggplot(d) +
  aes(x = x, y = y_obs) +  
  geom_point() +
  geom_smooth(method = &quot;lm&quot;) +
  geom_smooth(color = &quot;red&quot;) +
  labs(caption = &quot;blue: linear model, red: LOESS smooth&quot;)</code></pre>
<p><img src="unnamed-chunk-11-1.png" width="480" /></p>
</div>
</div>
<div id="estimating-an-exponential-model-using-lm" class="section level1">
<h1>Estimating an exponential model using <code>lm()</code></h1>
<p>We know that <span class="math inline">\(log(y) = x\)</span> describes an exponential model, because if we de-log both sides of the equations we obtain:</p>
<p><span class="math display">\[y = e^x \qquad.\]</span></p>
<pre class="r"><code>lm1 &lt;- lm(log(y_obs) ~ x, data = d )
summary(lm1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(y_obs) ~ x, data = d)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.27759 -0.03704  0.00230  0.03802  0.21401 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.0184587  0.0041928  -4.402 1.19e-05 ***
## x            0.1023805  0.0007208 142.036  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.0658 on 998 degrees of freedom
## Multiple R-squared:  0.9529, Adjusted R-squared:  0.9528 
## F-statistic: 2.017e+04 on 1 and 998 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>If we delog. the slope coefficient:</p>
<pre class="r"><code>exp(coef(lm1)[2])</code></pre>
<pre><code>##        x 
## 1.107805</code></pre>
<p>That is, we found a growth rate of approx. 11 percentage points.</p>
</div>
<div id="model-diagnostics" class="section level1">
<h1>Model diagnostics</h1>
<pre class="r"><code>plot(lm1, which = 1)</code></pre>
<p><img src="unnamed-chunk-14-1.png" width="480" /></p>
<p>The residual plot tells us that our linear approximation is not too bad.</p>
</div>
<div id="plot-the-exponential-fit" class="section level1">
<h1>Plot the exponential fit</h1>
<p>Let’s plot it using a y scale in the raw data (delogged).</p>
<pre class="r"><code>d &lt;-
  d %&gt;%
  mutate(y_pred = exp(predict(lm1)))</code></pre>
<pre class="r"><code>ggplot(d) +
  aes(x = x) +  
  geom_point(aes(y = y_obs)) +
  geom_point(aes(y = y_pred), color = &quot;red&quot;) +
  labs(caption = &quot;red: predicted values, black: observed values&quot;)</code></pre>
<p><img src="unnamed-chunk-16-1.png" width="480" /></p>
<p>As identified by the model diagnostics, the fit is, despite the seemingly high <span class="math inline">\(R^2\)</span> not too good.</p>
</div>
<div id="plot-with-a-log-y-axis" class="section level1">
<h1>Plot with a log-y axis</h1>
<p>Let’s plot the model with a log-y-axis.</p>
<pre class="r"><code>ggplot(d) +
  aes(x = x) +
  geom_point(aes(y = y_obs)) +
  scale_y_continuous(trans = &quot;log&quot;, 
                     limits = c(0.1, 10),
                     breaks=trans_breaks(&#39;log&#39;, function(x) e^x),
                     labels=trans_format(&#39;log&#39;, math_format(e^.x))
                     ) +
  scale_x_continuous(limits = c(0, 10)) +
  geom_abline(slope = exp(coef(lm1)[2])-1, 
              intercept = exp(coef(lm1)[1]),
              color = &quot;red&quot;)</code></pre>
<p><img src="unnamed-chunk-17-1.png" width="480" /></p>
<p>Note that the y axis is scaled in powers of <span class="math inline">\(e\)</span>.</p>
</div>
<div id="acknowledgements" class="section level1">
<h1>Acknowledgements</h1>
<p>This post profited from some remarks of <a href="https://www.sefiroth.net/nab/">Norman Markgraf</a>.</p>
</div>
