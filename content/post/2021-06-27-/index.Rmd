---
title: 'Estimating the exponential growth rate approximating a linear function'
author: Sebastian Sauer
date: '2021-06-27'
slug: ''
categories:
  - rstats
tags:
  - math
  - musings
---


```{r global-knitr-options, include=FALSE}
knitr::opts_chunk$set(fig.pos = 'H',
  fig.asp = 0.618,
  fig.width = 5,
  fig.cap = "", 
  fig.path = "",
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  cache = FALSE,
  fig.show = "hold")
```


```{r}
library(tidyverse)
library(scales)
```



# Exponential growth


Exponential growth, that is something that is growing relative to its science, hence ubuiquitious in nature, is conveniently and elegantly described by the growth constant $e$:

$$y = e^{\lambda x}$$


And its graph is this for $\lambda=1$:



```{r}
p0 <- ggplot(data.frame(x = seq(from = 0, 
                                to = 3,
                                by = .1))) +
  aes(x = x) +
  theme_minimal()

p0 +
  stat_function(fun = ~ exp(.x))
```


`exp(x)` does nothing more than computing $e^x$, where $e \approx 2.7182...$.


```{r}
e <- exp(1)
e
```



# Approximating a linear function with a constant $\lambda$


The exponential function can also be used to mirror or approximate a linear function with a constant $\lambda$, which may sound weird, but it is possible for at least some range of the linear function:

$$y = exp(0.1 * x)$$


```{r}
p0 +
  stat_function(fun = ~ exp(0.1 * .x)) +
  scale_x_continuous(limits = c(0, 3)) +
  geom_abline(slope = 0.1,
              intercept = 1,
              color = "red",
              alpha = .6,
              size = 2)
```


For *some limited range*  we can closely approximate the exponential function.



# Close mirroring of the linear function


We can make use of the following equality:

$$x = e^{(\text{ln} x)}$$


Assume the linear function to be approximated is

$$y = 0.1\cdot x + 1$$

Then we have:

$$y = e^{\text{ln}(0.1x + 1)}.$$

In R:


```{r}
f <- function(x) exp(log(0.1*x + 1))
```

For example:

```{r}
x <- c(-3:10)
f(x)
```

We need to remember that negative numbers are not defined for the log.

As a diagram:


```{r}
p0 +
  stat_function(fun = f) +
  scale_x_continuous(limits = c(0, 3)) +
  geom_abline(slope = 0.1,
              intercept = 1,
              color = "red",
              alpha = .6,
              size = 2) +
  scale_y_continuous(limits = c(0, 5))
```


It is not neccessarily an disadvantage that we cannot model/mirror negative x values using this approach as growth processes only feature positive values.


# Simulate some data

## Linear model

Here's a simple linear model, $y \sim x+1$.

```{r}
d <- 
  tibble(
    x = rep(seq(from = 0.1, to = 10, by = .1), 10),
    e = rnorm(n = length(x), sd = .1),  # error term
    y = x + 1,
    y_obs = y + e)
```


Plot it:


```{r}
ggplot(d) +
  aes(x = x, y = y_obs) +  
  geom_point() +
  geom_smooth(method = "lm")
```

## Exponential data


In contrast, consider this exponential function:


```{r}
d <- 
  tibble(
    x = rep(seq(from = 0.1, to = 10, by = .1), 10),
    err = rnorm(n = length(x), sd = .1),  # error term
    y = exp(0.1*x),
    y_obs = y + err)
```

Plot it:

```{r}
ggplot(d) +
  aes(x = x, y = y_obs) +  
  geom_point() +
  geom_smooth(method = "lm") +
  geom_smooth(color = "red") +
  labs(caption = "blue: linear model, red: LOESS smooth")
```




# Estimating an exponential model using `lm()`


We know that $log(y) = x$ describes an exponential model, because if we de-log both sides of the equations we obtain:

$$y = e^x \qquad.$$


```{r}
lm1 <- lm(log(y_obs) ~ x, data = d )
summary(lm1)
```


If we delog. the slope coefficient:

```{r}
exp(coef(lm1)[2])
```


That is, we found a growth rate of approx. `r round(exp(coef(lm1)[2])*100)-100` percentage points.


# Model diagnostics

```{r}
plot(lm1, which = 1)
```

The residual plot tells us that our linear approximation is not too bad.


# Plot the exponential fit

Let's plot it using a y scale in the raw data (delogged). 


```{r}
d <-
  d %>%
  mutate(y_pred = exp(predict(lm1)))
```



```{r}
ggplot(d) +
  aes(x = x) +  
  geom_point(aes(y = y_obs)) +
  geom_point(aes(y = y_pred), color = "red") +
  labs(caption = "red: predicted values, black: observed values")
```


As identified by the model diagnostics, the fit is, despite the seemingly high $R^2$ not too good.

# Plot with a log-y axis

Let's plot the model with a log-y-axis.


```{r}
ggplot(d) +
  aes(x = x) +
  geom_point(aes(y = y_obs)) +
  scale_y_continuous(trans = "log", 
                     limits = c(0.1, 10),
                     breaks=trans_breaks('log', function(x) e^x),
                     labels=trans_format('log', math_format(e^.x))
                     ) +
  scale_x_continuous(limits = c(0, 10)) +
  geom_abline(slope = exp(coef(lm1)[2])-1, 
              intercept = exp(coef(lm1)[1]),
              color = "red")
```


Note that the y axis is scaled in powers of $e$.



# Acknowledgements


This post profited from some remarks of [Norman Markgraf](https://www.sefiroth.net/nab/).


