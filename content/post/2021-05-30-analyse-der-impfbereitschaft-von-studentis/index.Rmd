---
title: Analyse der Impfbereitschaft von Studentis
author: Sebastian Sauer
date: '2021-05-30'
draft: TRUE
slug: analyse-der-impfbereitschaft-von-studentis
categories:
  - rstats
tags:
  - dataviz
---


# Analyse der Impfbereitschaft

Im Rahmen einer [Umfrage](https://docs.google.com/forms/d/1Rmo-yq7EHD7ZbH1FA9ad2mMxCenwST2sJVyHRgkY3u8/edit?usp=forms_home&ths=true) wurde die Impfbereitschaft von Studentis im Hinblick auf eine Covid-19-Impfung erfasst. 

Es stellt sich die Aufgabe, zentrale Erkentnisse aus diesen Daten darzustellen. In diesem Post werden einige Ansätze dazu vorgestellt.

# Vorbereitung

## Pakete laden

```{r}
library(tidyverse)
library(corrr)   # Komfort bei Korrelationen 
library(broom)  # tidy Regressionsergebnisse
```


## Daten laden


```{r}
d <- read_csv("https://raw.githubusercontent.com/sebastiansauer/2021-sose/master/data/Impfbereitschaft/d3.csv")
```


```{r}
glimpse(d)
```


# Daten und Variablen

Über die Umfrage kann der Inhalt der Variablen eingesehen werden. Weiter ist eine [grundlegende Datenaufbereitung hier dokumentiert](https://github.com/sebastiansauer/willingness-vaccination-covid19).

Das Codebook findet sich [im gleichen Repo](https://github.com/sebastiansauer/willingness-vaccination-covid19/blob/main/data/codebook-covid-vac-willingness.xlsx).


## Sind die Items schon umgepolt?

*Ja*, ein Blick in die Datenaufbereitung zeigt, dass die (ursprünglich)  negativ gepolten Items bereits "richtig" (positiv) gepolt vorliegen.


## Liegen Mittelwerte für die Persönlichkeits-Dimensionen vor?

*Ja*, es liegen bereits Mittelwerte ("Scores") für die fünf Big-Five-Persönlichkeitsdimensionen vor.



# Daten verstehen


## Fehlende Werte

Summieren wir die fehlenden Werte über alle Spalten:

```{r}
d %>% 
  summarise(across(everything(), ~ sum(is.na(.))))
```
Nur bei den Kommentaren fehlen Werte.


## Nominal skalierte Variablen in numerische umwandeln

Welche nominal skalierten Variablen liegen vor? Gut, man könnte einen einfachen Blick in die Tabelle werfen, aber so ist es etwas cooler:

```{r}
d %>% 
  select(where(is.numeric)) %>% 
  names()
```

Gegenprobe:

```{r}
d %>% 
  select(where(~!is.numeric(.))) %>% 
  names()
```


*Geschlecht* ist ein Kandidat, der -- wenn es nur zwei Werte gibt -- mit Nutzen in eine numerische Variable umgewandelt werden kann.

```{r}
d %>% 
  count(sex)
```

Da es von einer Stufe (`divers`) nur eine Beobachtung gibt, bietet es sich an, diese Beobachtung entweder der Gruppe (Frau oder Mann) zuzuordnen, für die die restlichen Werte typischer sind oder diese Beobachtung aufzugeben. Der Einfachheit halber entscheide ich mich für Lezteres.

```{r}
d2 <-
  d %>% 
  mutate(sex = case_when(
    sex == "Divers" ~ NA_character_,
    TRUE ~ sex
  ))
```


```{r}
d2 %>% 
  count(sex)
```


```{r}
d2 <-
  d2 %>% 
  mutate(is_female = case_when(
    sex == "Frau" ~ 1,
    sex == "Mann" ~ 0,
    TRUE ~ NA_real_
  )) %>% 
  select(-sex)
```

```{r}
d2 %>% 
  count(is_female)
```


Jetzt können wir `is_female` z.B. für eine Korrelation heranziehen. Aber Achtung: Die Schiefe der Verteilung limitiert die Höhe der Korrelation!


## Welche Variablen korrelieren mit der Impfbereitschaft?


```{r}
d2 %>% 
  select(where(is.numeric)) %>% 
  select(-matches("[[:digit:]]")) %>% 
  correlate() %>% 
  focus(willingness) %>% 
  arrange(-abs(willingness))
```


Hier haben wir Variablen, deren Namen eine Zahl beinhalteten, entfernt. Der Grund ist, dass diese Variablen (`neuro1`, ...) einzelne Items codieren, hier aber nur die ganze Skala einer Big-Five-Dimension betrachtet werden soll.


## Korrelation der Items pro Big-Five-Dimension

Theoretisch müssten die Items jeweils einer Big-Five-Dimension hoch korrelieren. Überprüfen wir das mal.


```{r}
d2 %>% 
  select(matches("[[:digit:]]")) %>% 
  pivot_longer(everything()) %>% 
  mutate(dimension = str_extract(name, "\\D+")) %>%   # alle Nicht-Ziffern
  mutate(name = case_when(
    str_detect(name, "1") ~ "i1",
    str_detect(name, "2") ~ "i2",
    TRUE ~ NA_character_
  )) %>% 
  pivot_wider(names_from = "name",
              values_from = "value") %>% 
  mutate(cor_i1_i2 = map2_dbl(.x = i1, 
                              .y = i2,
                              .f = cor))
```

Puh, das war schon etwas Daten-Gymnastik. Man hätte das gleiche Ergebnis auch einfacher bekommen können, etwa so:


```{r}
d2 %>%
  select(extra1, extra2) %>% 
  correlate()
```
Und so weiter für jede der fünf Big-Five-Dimensionen.

Halten wir fest: Für Verträglichkeit (`agree`) ist die Korrelation gering; ansonsten mittel bis gut.

# Modell mit den Big-Five-Dimensionen als Prädiktoren

In meinem Kopf schwebt die Idee, die fünf Big-Five-Dimensionen als Prädiktoren der Impfbereitschaft zu präsentieren. Der Grund ist einfach: Die Forschungsfrage "Sagt die Persönlichkeit (voraus), wer sich impfen lassen wird und wer nicht?" ist bestechend und daher wert, analysiert zu werden.


```{r}
lm1 <- lm(willingness ~ extra + neuro + agree + cons + open, data = d2)


tidy(lm1)
```

Das Ergebnis zeigt: Das Signal-Rausch-Verhältnis ist höchstens bei `cons` akzeptabel, und das auch nur grenzwertig.

Reicht das für eine "Story"? Eher nicht.

# Zur Datenqualität

Insgesamt muss die Datenqualität als eingeschränkt bezeichnet werden: Die Stichprobe ist nicht groß und die Repräsentativität unklar. Non-Response-Bias kann nicht abgeschätzt werden. Daher sollten die Ergebnisse nur mit großem Vorbehalt interpretiert werden.

Kausale Interpretationen der Daten sind kaum möglich.


# Visualisierung 1

Diese Visualisierung soll eine sehr einfache, eingängige Visualisierung des Zusammenhangs von Persönlichkeit und Impfbereitschaft aufzeigen. Die Visualisierung ist unterkomplex. Mehr dazu weiter unten.


## Median-Aufteilung

Für eine einfaches Verständnis für eine Zielgruppe, die wenig "datenkundig" (data literate) ist, soll hier eine Dichotomisierung der Daten (z.B. anhand des Medians) vollzogen werden. 

Ausdrücklich sei gewarnt, dass eine Median-Aufteilung statistisch fahrlässig ist. Diese Methode wird hier nur illustrativ gezeigt.


```{r}
main_vars <- c("willingness",
               "extra",
               "open",
               "agree",
               "neuro",
               "cons")
```


```{r}
median_split <- function(var) {
  ifelse(var > median(var, na.rm = TRUE), 1, 0)
}
```




```{r}
d3 <- 
  d2 %>% 
  select(all_of(main_vars)) %>% 
  mutate(across(.cols = all_of(main_vars),
                .fns = median_split,
                .names = "{.col}_bin"  # "bin" wie "binär"
                ))
```



Natürlich hätte man das auch wieder einfacher lösen können (aber mit mehr Tipp-Aufwand):

```{r}
d2 %>% 
  mutate(willingness_bin = ifelse(willingness > median(willingness), 1, 0)) %>% 
  select(willingness, willingness_bin)
```


Die Verteilung von `willingness` scheint sehr schief zu sein:


```{r}
d2 %>% 
  ggplot(aes(x = willingness)) + 
  geom_density()
```

## Dichotomisierung anhand des Skalen-Mittelpunkts

Anstelle des Medians soll hier der Skalen-Mittelpunkt zur Dichotomisierung gewählt werden:

```{r}
scale01 <- function(x) {
  rng <- range(x, na.rm = TRUE)
  (x - rng[1]) / (rng[2] - rng[1])
}
```

Zuerst skalieren wir auf 0 bis 100%, um die Skalierung anzugleichen:

```{r}
d4 <- 
  d2 %>% 
  select(all_of(main_vars)) %>% 
  mutate(across(everything(),
                scale01,
                .names = "{.col}_01"))
```


```{r}
head(d4)
```


Dann teilen wir in kleine und große Werte auf: Kleiner 50% soll "klein" sein, sonst "groß".


```{r}
bin_01 <- function(var) {
  ifelse(var > .5, 1, 0)
}
```


```{r}
d5 <-
  d4 %>% 
  select(contains("_01")) %>% 
  mutate(across(everything(),
                bin_01))
```

```{r}
dim(d5)
```


```{r}
head(d5)
```




## Anteile berechnen (eindimensional)

```{r}
d6 <- 
  d5 %>% 
  select(contains("_01")) %>% 
  pivot_longer(everything()) %>% 
  count(name, value) %>% 
  group_by(name) %>% 
  mutate(prop = n / sum(n))
```

```{r}
head(d6)
```




## Als Balkendiagramm


```{r}
d6 %>% 
  select(name, prop) %>% 
  mutate(dimension = str_remove(name,"_01")) %>% 
  group_by(dimension) %>% 
  mutate(value = c(0,1)) %>% 
  ungroup() %>% 
  ggplot() +
  aes(x = value, y = prop) +
  geom_col() +
  facet_wrap(~ dimension)
```


## Anteil hoher Big-Five-Werte bei Impfwilligen (zweidimensional)



```{r}
d7 <- 
  d5 %>% 
  pivot_longer(extra_01:last_col()) %>% 
  group_by(name, willingness_01) %>% 
  count(value) %>% 
  mutate(prop = n / sum(n)) 
```


```{r}
head(d7)
```

```{r}
name_order <- 
  d7 %>% 
  filter(value == 1, willingness_01 == 1) %>% 
  arrange(-prop) %>% 
  pull(name) 

name_order
```


```{r}
name_order_de <- c(
  "hohe Offenheit",
  "hohe Gewissenhaftigkeit",
  "hohe Extraversion",
  "hohe Verträglichkeit",
  "hohe Neurotizismus"
)
```



```{r}
d8 <-
  d7 %>% 
  mutate(name = factor(name, levels = name_order))
```



```{r}
d8 %>% 
  filter(willingness_01 == 1) %>% 
  mutate(Impfbereitschaft = case_when(
    value == 0 ~ "geringer",
    value == 1 ~ "höher"
  )) %>% 
  ggplot() +
  aes(x = name, y = n, fill = as.factor(Impfbereitschaft)) +
  geom_col(position = "fill") +
  scale_fill_viridis_d() +
  theme_minimal() +
  coord_flip() +
  scale_x_discrete(labels = name_order_de) +
  labs(x = NULL,
       y = "Anteil",
       fill = "Impfbereitschaft",
       title = "Menschen mit höherer Offenheit zeigen höhere Impfbereitschaft",
       caption = "n=164; nicht repräsentative Stichprobe. Nur eingeschränkt interpretierbar")
```

# Geom FontAwesome

Korrespondenz von Offenheit und Impfbereitschaft





```{r}
d8 %>% 
  filter(name == "open_01")
```


```{r}
willingness_high <- c("geringe Offenheit" = 28, 
                      "hohe Offenheit" = 72)
```


```{r}
install_fa_fonts()
library(extrafont)
font_import(paths = "/Users/sebastiansaueruser/Rlibs/waffle/fonts/", prompt = F)
```


```{r}
library(waffle)
library(extrafont)
waffle(willingness_high,
       flip = TRUE,
       reverse = TRUE,
       use_glyph = "syringe",
       colors = c("grey60", "dodgerblue"),
       size = .1,
       title = "Persönlichkeitsmerkmal 'Offenheit' \nunter Personen mit hoher Impfbereitschaft") +
  expand_limits(y = c(0, 4)) +
  theme(legend.position = "bottom")

#ggsave(test.png)
```


```{r}
d5 %>% 
  select(open_01, willingness_01) %>% 
  ggplot(aes(fill = factor(open_01)), values = open_01) +
  geom_waffle(n_rows = 10, color = "white") +
  facet_wrap(~ willingness_01)
```

