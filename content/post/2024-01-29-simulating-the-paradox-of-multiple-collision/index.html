---
title: Simulating multiple event collision
author: Sebastian Sauer
date: '2024-01-29'
slug: simulating-multiple-event-collision
categories:
  - rstats
tags:
  - simulation
output:
  blogdown::html_page:
    toc: yes
    number_sections: yes
---


<div id="TOC">
<ul>
<li><a href="#motivation" id="toc-motivation"><span class="toc-section-number">1</span> Motivation</a></li>
<li><a href="#setup" id="toc-setup"><span class="toc-section-number">2</span> Setup</a></li>
<li><a href="#constantsparameters" id="toc-constantsparameters"><span class="toc-section-number">3</span> Constants/Parameters</a></li>
<li><a href="#choose-your-options" id="toc-choose-your-options"><span class="toc-section-number">4</span> Choose your options</a></li>
<li><a href="#repeat-it-many-times" id="toc-repeat-it-many-times"><span class="toc-section-number">5</span> Repeat it many times</a></li>
<li><a href="#results" id="toc-results"><span class="toc-section-number">6</span> Results</a></li>
<li><a href="#conclusion" id="toc-conclusion"><span class="toc-section-number">7</span> Conclusion</a></li>
<li><a href="#make-a-matching-more-probable" id="toc-make-a-matching-more-probable"><span class="toc-section-number">8</span> Make a matching more probable</a></li>
<li><a href="#results-2" id="toc-results-2"><span class="toc-section-number">9</span> Results 2</a></li>
<li><a href="#conclusions-2" id="toc-conclusions-2"><span class="toc-section-number">10</span> Conclusions 2</a></li>
<li><a href="#make-a-matching-highly-probable" id="toc-make-a-matching-highly-probable"><span class="toc-section-number">11</span> Make a matching highly probable</a></li>
<li><a href="#results-3" id="toc-results-3"><span class="toc-section-number">12</span> Results 3</a></li>
<li><a href="#conclusions-3" id="toc-conclusions-3"><span class="toc-section-number">13</span> Conclusions 3</a></li>
<li><a href="#reproducibility" id="toc-reproducibility"><span class="toc-section-number">14</span> Reproducibility</a></li>
</ul>
</div>

<div id="motivation" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Motivation</h1>
<p>Have you ever tried to find a time slot for a meeting using a tool such as “Doodle”?</p>
<p>If not, consider yourself lucky.
Otherwise you will be well aware of the chagrin of finding a time slot that suits all of your colleagues.</p>
<p>Let’s call a time slot where all of your colleagues invited for the meeting have a free time slot a <em>matching time slot</em>.</p>
<p>Some persons find that the best way to find a matchting time slot is to offer a great number of time slots to your colleagues.
Personally I find this appraoch difficult as I would have to keep track of and block a lot of time slots in my calendar. In addition, I feel it would be difficult to find a matching time slot as most colleagues will not take the hazzle and report many free time slots.
Call me pessimistic, but I suspect that most colleagues will choose about 3 time slots, but not more, because it would be too difficult for them to keep their calendars in sync. (A sentiment I share.)</p>
<p>Now, I wondered that’s the probability of finding at least one matching time slot when addressing <em>n</em> colleagues, providing each of them with <em>o</em> options, assuming each colleague will pick <em>p</em> options completely random.</p>
<p>In more stochastic parlance, this problem is a somewhat involved example of the collision problem.</p>
<p>Here’s a simulation study for that.</p>
</div>
<div id="setup" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Setup</h1>
<pre class="r"><code>library(tidyverse)  # data wrangling</code></pre>
<p>Initialize variables:</p>
<pre class="r"><code>slots_chosen &lt;- list()</code></pre>
</div>
<div id="constantsparameters" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Constants/Parameters</h1>
<pre class="r"><code>n_colleagues &lt;- 4  # number of colleagues invited to your meeting
p &lt;- 3  # number of chosen appointment options per colleague
o &lt;- 30 # number of possible options to choose from
r &lt;- 1e4  # number of simulated samples</code></pre>
</div>
<div id="choose-your-options" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Choose your options</h1>
<pre class="r"><code>for (i in 1:n_colleagues){
  slots_chosen[[i]] &lt;- sample(1:o, size = p)
}</code></pre>
<pre class="r"><code>slots_chosen
#&gt; [[1]]
#&gt; [1]  1 30 19
#&gt; 
#&gt; [[2]]
#&gt; [1] 20 26 10
#&gt; 
#&gt; [[3]]
#&gt; [1] 24  7 23
#&gt; 
#&gt; [[4]]
#&gt; [1] 28 20 11</code></pre>
<pre class="r"><code>slots_chosen_vec &lt;- unlist(slots_chosen)

slots_chosen_tbl &lt;- slots_chosen_vec |&gt; table() 

slots_chosen_collision &lt;- names(slots_chosen_tbl[slots_chosen_tbl &gt; 1])
slots_chosen_tbl &lt;- slots_chosen_tbl[slots_chosen_tbl &gt; 1]</code></pre>
<p>Put it in a function:</p>
<pre class="r"><code>count_common_slots &lt;- function(n_colleagues, o, p){
  
  for (i in 1:n_colleagues){
    slots_chosen[[i]] &lt;- sample(1:o, size = p)
  }
  slots_chosen_vec &lt;- unlist(slots_chosen)
  slots_chosen_tbl &lt;- slots_chosen_vec |&gt; table() 
  
  slots_chosen_collision &lt;- slots_chosen_tbl[slots_chosen_tbl &gt; 1]
  
  slots_chosen_df &lt;- data.frame(slots_chosen_collision)
  
  if (nrow(slots_chosen_df) == 0) slots_chosen_df &lt;- data.frame(slots_chosen_vec = factor(NA),
                                                                Freq = NA_integer_)
  if (ncol(slots_chosen_df) == 1) slots_chosen_df &lt;- data.frame(slots_chosen_vec = factor(row.names(slots_chosen_df)),
                                                                Freq = slots_chosen_df$slots_chosen_collision)
  
  return(slots_chosen_df)
}</code></pre>
<p>Test it:</p>
<pre class="r"><code>#debug(count_common_slots)
slots_chosen_collision &lt;- count_common_slots(n_colleagues = n_colleagues, o = o, p = p)
slots_chosen_collision
#&gt;   slots_chosen_vec Freq
#&gt; 1                2    2</code></pre>
</div>
<div id="repeat-it-many-times" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Repeat it many times</h1>
<pre class="r"><code>smples &lt;- 
  slots_chosen_collision |&gt; 
  mutate(id = 1)

for (i in 2:r){
  tmp &lt;- count_common_slots(n_colleagues = n_colleagues, o = o, p = p)
  tmp$id &lt;- i
  
  smples &lt;-
    smples |&gt; 
    bind_rows(tmp)
  
  #print(paste0(i,&quot;/&quot;,r))
  }</code></pre>
</div>
<div id="results" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Results</h1>
<pre class="r"><code>smples_tbl &lt;-
smples |&gt; 
  group_by(id) |&gt; 
  summarise(n_hits = n()) |&gt; 
  count(n_hits) |&gt; 
  mutate(prop = n / sum(n))

smples_tbl
#&gt; # A tibble: 5 × 3
#&gt;   n_hits     n   prop
#&gt;    &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
#&gt; 1      1  4991 0.499 
#&gt; 2      2  3479 0.348 
#&gt; 3      3  1318 0.132 
#&gt; 4      4   206 0.0206
#&gt; 5      5     6 0.0006</code></pre>
<pre class="r"><code>ggplot(smples_tbl) +
  aes(x = n_hits, y = n) +
  geom_vline(aes(xintercept = n_colleagues)) +
  geom_col() +
  labs(title = &quot;Proportion of collisions&quot;,
       subtitle = paste0(n_colleagues, &quot; colleagues, &quot;, p, &quot; picked time slots, &quot;, o, &quot; options to chose from, &quot;, r, &quot; simulated samples&quot;),
       caption = &quot;The vertical line indicates the event that enough colleagues chose the same time slot.&quot;) +
  geom_label(aes(label = n, x = n_hits)) </code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(smples_tbl) +
  aes(x = n_hits, y = prop) +
  geom_vline(aes(xintercept = n_colleagues)) +
  geom_col() +
  labs(title = &quot;Proportion of collisions&quot;,
       subtitle = paste0(n_colleagues, &quot; colleagues, &quot;, p, &quot; picked time slots, &quot;, o, &quot; options to chose from, &quot;, r, &quot; simulated samples&quot;),
       caption = &quot;The vertical line indicates the event that enough colleagues chose the same time slot.&quot;) +
  geom_label(aes(label = prop, x = n_hits))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="conclusion" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Conclusion</h1>
<p>As can be seen, the probability of finding a matching time slot is quick small, given the parameter values above.
Not impossible, but too low to rely on this approach in my opinion.</p>
</div>
<div id="make-a-matching-more-probable" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Make a matching more probable</h1>
<p>Let’s provide less options too chose from in order to find a time slot for the meeting to your colleagues:</p>
<pre class="r"><code>o &lt;- 12  # time slot options too chose from</code></pre>
<pre class="r"><code>smples &lt;- 
  slots_chosen_collision |&gt; 
  mutate(id = 1)

for (i in 2:r){
  tmp &lt;- count_common_slots(n_colleagues = n_colleagues, o = o, p = p)
  tmp$id &lt;- i
  
  smples &lt;-
    smples |&gt; 
    bind_rows(tmp)
  
  #print(paste0(i,&quot;/&quot;,r))
  }</code></pre>
</div>
<div id="results-2" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Results 2</h1>
<pre class="r"><code>smples_tbl &lt;-
smples |&gt; 
  group_by(id) |&gt; 
  summarise(n_hits = n()) |&gt; 
  count(n_hits) |&gt; 
  mutate(prop = n / sum(n))

smples_tbl
#&gt; # A tibble: 6 × 3
#&gt;   n_hits     n   prop
#&gt;    &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
#&gt; 1      1   176 0.0176
#&gt; 2      2  1955 0.196 
#&gt; 3      3  4484 0.448 
#&gt; 4      4  2900 0.29  
#&gt; 5      5   480 0.048 
#&gt; 6      6     5 0.0005</code></pre>
<pre class="r"><code>ggplot(smples_tbl) +
  aes(x = n_hits, y = prop) +
  geom_vline(aes(xintercept = n_colleagues)) +
  geom_col() +
  labs(title = &quot;Proportion of collisions&quot;,
       subtitle = paste0(n_colleagues, &quot; colleagues, &quot;, p, &quot; picked time slots, &quot;, o, &quot; options to chose from, &quot;, r, &quot; simulated samples&quot;),
       caption = &quot;The vertical line indicates the event that enough colleagues chose the same time slot.&quot;) +
  geom_label(aes(label = prop, x = n_hits))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-13-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="conclusions-2" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Conclusions 2</h1>
<p>Now we can see that a matching has become more probable, although still not highly likely.</p>
</div>
<div id="make-a-matching-highly-probable" class="section level1" number="11">
<h1><span class="header-section-number">11</span> Make a matching highly probable</h1>
<p>Let’s provide only a few options too chose from in order to find a time slot for the meeting to your colleagues:</p>
<pre class="r"><code>o &lt;- 5  # number of time slot options too chose from</code></pre>
<pre class="r"><code>smples &lt;- 
  slots_chosen_collision |&gt; 
  mutate(id = 1)

for (i in 2:r){
  tmp &lt;- count_common_slots(n_colleagues = n_colleagues, o = o, p = p)
  tmp$id &lt;- i
  
  smples &lt;-
    smples |&gt; 
    bind_rows(tmp)
  
  #print(paste0(i,&quot;/&quot;,r))
  }</code></pre>
</div>
<div id="results-3" class="section level1" number="12">
<h1><span class="header-section-number">12</span> Results 3</h1>
<pre class="r"><code>smples_tbl &lt;-
smples |&gt; 
  group_by(id) |&gt; 
  summarise(n_hits = n()) |&gt; 
  count(n_hits) |&gt; 
  mutate(prop = n / sum(n))

smples_tbl
#&gt; # A tibble: 4 × 3
#&gt;   n_hits     n   prop
#&gt;    &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
#&gt; 1      1     1 0.0001
#&gt; 2      3  1467 0.147 
#&gt; 3      4  6057 0.606 
#&gt; 4      5  2475 0.248</code></pre>
<pre class="r"><code>ggplot(smples_tbl) +
  aes(x = n_hits, y = prop) +
  geom_vline(aes(xintercept = n_colleagues)) +
  geom_col() +
  labs(title = &quot;Proportion of collisions&quot;,
       subtitle = paste0(n_colleagues, &quot; colleagues, &quot;, p, &quot; picked time slots, &quot;, o, &quot; options to chose from, &quot;, r, &quot; simulated samples&quot;),
       caption = &quot;The vertical line indicates the event that enough colleagues chose the same time slot.&quot;) +
  geom_label(aes(label = prop, x = n_hits))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-16-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="conclusions-3" class="section level1" number="13">
<h1><span class="header-section-number">13</span> Conclusions 3</h1>
<p>Now we can see that a matching has become highly probable.</p>
</div>
<div id="reproducibility" class="section level1" number="14">
<h1><span class="header-section-number">14</span> Reproducibility</h1>
<pre><code>#&gt; ─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────
#&gt;  setting  value
#&gt;  version  R version 4.2.1 (2022-06-23)
#&gt;  os       macOS Big Sur ... 10.16
#&gt;  system   x86_64, darwin17.0
#&gt;  ui       X11
#&gt;  language (EN)
#&gt;  collate  en_US.UTF-8
#&gt;  ctype    en_US.UTF-8
#&gt;  tz       Europe/Berlin
#&gt;  date     2024-01-29
#&gt;  pandoc   3.1.1 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/ (via rmarkdown)
#&gt; 
#&gt; ─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────
#&gt;  package     * version date (UTC) lib source
#&gt;  blogdown      1.18    2023-06-19 [1] CRAN (R 4.2.0)
#&gt;  bookdown      0.36    2023-10-16 [1] CRAN (R 4.2.0)
#&gt;  bslib         0.5.1   2023-08-11 [1] CRAN (R 4.2.0)
#&gt;  cachem        1.0.8   2023-05-01 [1] CRAN (R 4.2.0)
#&gt;  callr         3.7.3   2022-11-02 [1] CRAN (R 4.2.0)
#&gt;  cli           3.6.1   2023-03-23 [1] CRAN (R 4.2.0)
#&gt;  colorout    * 1.3-0   2023-11-08 [1] Github (jalvesaq/colorout@8384882)
#&gt;  colorspace    2.1-0   2023-01-23 [1] CRAN (R 4.2.0)
#&gt;  crayon        1.5.2   2022-09-29 [1] CRAN (R 4.2.1)
#&gt;  devtools      2.4.5   2022-10-11 [1] CRAN (R 4.2.1)
#&gt;  digest        0.6.33  2023-07-07 [1] CRAN (R 4.2.0)
#&gt;  dplyr       * 1.1.3   2023-09-03 [1] CRAN (R 4.2.0)
#&gt;  ellipsis      0.3.2   2021-04-29 [1] CRAN (R 4.2.0)
#&gt;  evaluate      0.21    2023-05-05 [1] CRAN (R 4.2.0)
#&gt;  fansi         1.0.5   2023-10-08 [1] CRAN (R 4.2.0)
#&gt;  farver        2.1.1   2022-07-06 [1] CRAN (R 4.2.0)
#&gt;  fastmap       1.1.1   2023-02-24 [1] CRAN (R 4.2.0)
#&gt;  forcats     * 1.0.0   2023-01-29 [1] CRAN (R 4.2.0)
#&gt;  fs            1.6.3   2023-07-20 [1] CRAN (R 4.2.0)
#&gt;  generics      0.1.3   2022-07-05 [1] CRAN (R 4.2.0)
#&gt;  ggplot2     * 3.4.4   2023-10-12 [1] CRAN (R 4.2.0)
#&gt;  glue          1.6.2   2022-02-24 [1] CRAN (R 4.2.0)
#&gt;  gtable        0.3.4   2023-08-21 [1] CRAN (R 4.2.0)
#&gt;  highr         0.10    2022-12-22 [1] CRAN (R 4.2.0)
#&gt;  hms           1.1.3   2023-03-21 [1] CRAN (R 4.2.0)
#&gt;  htmltools     0.5.6.1 2023-10-06 [1] CRAN (R 4.2.0)
#&gt;  htmlwidgets   1.6.2   2023-03-17 [1] CRAN (R 4.2.0)
#&gt;  httpuv        1.6.11  2023-05-11 [1] CRAN (R 4.2.0)
#&gt;  jquerylib     0.1.4   2021-04-26 [1] CRAN (R 4.2.0)
#&gt;  jsonlite      1.8.7   2023-06-29 [1] CRAN (R 4.2.0)
#&gt;  knitr         1.45    2023-10-30 [1] CRAN (R 4.2.1)
#&gt;  labeling      0.4.3   2023-08-29 [1] CRAN (R 4.2.0)
#&gt;  later         1.3.1   2023-05-02 [1] CRAN (R 4.2.0)
#&gt;  lifecycle     1.0.4   2023-11-07 [1] CRAN (R 4.2.1)
#&gt;  lubridate   * 1.9.3   2023-09-27 [1] CRAN (R 4.2.0)
#&gt;  magrittr      2.0.3   2022-03-30 [1] CRAN (R 4.2.0)
#&gt;  memoise       2.0.1   2021-11-26 [1] CRAN (R 4.2.0)
#&gt;  mime          0.12    2021-09-28 [1] CRAN (R 4.2.0)
#&gt;  miniUI        0.1.1.1 2018-05-18 [1] CRAN (R 4.2.0)
#&gt;  munsell       0.5.0   2018-06-12 [1] CRAN (R 4.2.0)
#&gt;  pillar        1.9.0   2023-03-22 [1] CRAN (R 4.2.0)
#&gt;  pkgbuild      1.4.0   2022-11-27 [1] CRAN (R 4.2.0)
#&gt;  pkgconfig     2.0.3   2019-09-22 [1] CRAN (R 4.2.0)
#&gt;  pkgload       1.3.2.1 2023-07-08 [1] CRAN (R 4.2.0)
#&gt;  prettyunits   1.1.1   2020-01-24 [1] CRAN (R 4.2.0)
#&gt;  processx      3.8.2   2023-06-30 [1] CRAN (R 4.2.0)
#&gt;  profvis       0.3.8   2023-05-02 [1] CRAN (R 4.2.0)
#&gt;  promises      1.2.1   2023-08-10 [1] CRAN (R 4.2.0)
#&gt;  ps            1.7.5   2023-04-18 [1] CRAN (R 4.2.0)
#&gt;  purrr       * 1.0.2   2023-08-10 [1] CRAN (R 4.2.0)
#&gt;  R6            2.5.1   2021-08-19 [1] CRAN (R 4.2.0)
#&gt;  Rcpp          1.0.11  2023-07-06 [1] CRAN (R 4.2.0)
#&gt;  readr       * 2.1.4   2023-02-10 [1] CRAN (R 4.2.0)
#&gt;  remotes       2.4.2.1 2023-07-18 [1] CRAN (R 4.2.0)
#&gt;  rlang         1.1.1   2023-04-28 [1] CRAN (R 4.2.0)
#&gt;  rmarkdown     2.25    2023-09-18 [1] CRAN (R 4.2.0)
#&gt;  rstudioapi    0.15.0  2023-07-07 [1] CRAN (R 4.2.0)
#&gt;  sass          0.4.7   2023-07-15 [1] CRAN (R 4.2.0)
#&gt;  scales        1.2.1   2022-08-20 [1] CRAN (R 4.2.0)
#&gt;  sessioninfo   1.2.2   2021-12-06 [1] CRAN (R 4.2.0)
#&gt;  shiny         1.8.0   2023-11-17 [1] CRAN (R 4.2.1)
#&gt;  stringi       1.7.12  2023-01-11 [1] CRAN (R 4.2.0)
#&gt;  stringr     * 1.5.1   2023-11-14 [1] CRAN (R 4.2.1)
#&gt;  tibble      * 3.2.1   2023-03-20 [1] CRAN (R 4.2.0)
#&gt;  tidyr       * 1.3.0   2023-01-24 [1] CRAN (R 4.2.0)
#&gt;  tidyselect    1.2.0   2022-10-10 [1] CRAN (R 4.2.0)
#&gt;  tidyverse   * 2.0.0   2023-02-22 [1] CRAN (R 4.2.0)
#&gt;  timechange    0.2.0   2023-01-11 [1] CRAN (R 4.2.0)
#&gt;  tzdb          0.4.0   2023-05-12 [1] CRAN (R 4.2.0)
#&gt;  urlchecker    1.0.1   2021-11-30 [1] CRAN (R 4.2.0)
#&gt;  usethis       2.2.2   2023-07-06 [1] CRAN (R 4.2.0)
#&gt;  utf8          1.2.3   2023-01-31 [1] CRAN (R 4.2.0)
#&gt;  vctrs         0.6.4   2023-10-12 [1] CRAN (R 4.2.0)
#&gt;  withr         2.5.2   2023-10-30 [1] CRAN (R 4.2.1)
#&gt;  xfun          0.40    2023-08-09 [1] CRAN (R 4.2.0)
#&gt;  xtable        1.8-4   2019-04-21 [1] CRAN (R 4.2.0)
#&gt;  yaml          2.3.7   2023-01-23 [1] CRAN (R 4.2.0)
#&gt; 
#&gt;  [1] /Users/sebastiansaueruser/Rlibs
#&gt;  [2] /Library/Frameworks/R.framework/Versions/4.2/Resources/library
#&gt; 
#&gt; ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
