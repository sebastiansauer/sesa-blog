---
title: Predicting survival (Titanic) using a tidymodels approach
author: Sebastian Sauer
date: '2020-12-08'
draft: TRUE
slug: predicting-survival-titanic-using-a-tidymodels-approach
categories:
  - rstats
tags:
  - prediction
---

<script src="index_files/header-attrs/header-attrs.js"></script>
<link href="index_files/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="index_files/anchor-sections/anchor-sections.js"></script>


<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p>Let’s predict survival at the <a href="https://www.kaggle.com/c/titanic">Titanic disaster</a> using the Kaggle competition data, download from <a href="https://www.kaggle.com/c/titanic/data">here</a>.</p>
<p>We’ll make use of the <a href="https://www.tidymodels.org/start/models/">tidymodels</a> approach.</p>
</div>
<div id="load-packages" class="section level1">
<h1>Load packages</h1>
<pre class="r"><code>library(tidyverse)  # data wrangling
library(tidymodels)  # modelling
library(broom)  # tidy model output</code></pre>
</div>
<div id="load-data" class="section level1">
<h1>Load data</h1>
<pre class="r"><code>traindata_url &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Statistiklehre/main/data/titanic/train.csv&quot;
testdata_url &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Statistiklehre/main/data/titanic/test.csv&quot; </code></pre>
<pre class="r"><code>train &lt;- read_csv(traindata_url)
test &lt;- read_csv(testdata_url)</code></pre>
<pre class="r"><code>glimpse(train)
#&gt; Rows: 891
#&gt; Columns: 12
#&gt; $ PassengerId &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17…
#&gt; $ Survived    &lt;dbl&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, …
#&gt; $ Pclass      &lt;dbl&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3, 2, 3, …
#&gt; $ Name        &lt;chr&gt; &quot;Braund, Mr. Owen Harris&quot;, &quot;Cumings, Mrs. John Bradley (F…
#&gt; $ Sex         &lt;chr&gt; &quot;male&quot;, &quot;female&quot;, &quot;female&quot;, &quot;female&quot;, &quot;male&quot;, &quot;male&quot;, &quot;ma…
#&gt; $ Age         &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, 39, 14,…
#&gt; $ SibSp       &lt;dbl&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4, 0, 1, …
#&gt; $ Parch       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1, 0, 0, …
#&gt; $ Ticket      &lt;chr&gt; &quot;A/5 21171&quot;, &quot;PC 17599&quot;, &quot;STON/O2. 3101282&quot;, &quot;113803&quot;, &quot;3…
#&gt; $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, 51.8625…
#&gt; $ Cabin       &lt;chr&gt; NA, &quot;C85&quot;, NA, &quot;C123&quot;, NA, NA, &quot;E46&quot;, NA, NA, NA, &quot;G6&quot;, &quot;…
#&gt; $ Embarked    &lt;chr&gt; &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;Q&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S…</code></pre>
</div>
<div id="data-preprocessing" class="section level1">
<h1>Data preprocessing</h1>
<pre class="r"><code>train &lt;-
  train %&gt;% 
  mutate(Survived = factor(Survived))</code></pre>
</div>
<div id="define-recipe" class="section level1">
<h1>Define recipe</h1>
<pre class="r"><code>titanic_recipe &lt;- 
  recipe(Survived ~ ., data = train) %&gt;% 
  update_role(Name, PassengerId,  new_role = &quot;ID&quot;) %&gt;% 
  step_rm(Ticket, Cabin, Name, PassengerId) %&gt;% 
  step_dummy(all_nominal(), -all_outcomes()) %&gt;% 
  step_zv(all_predictors()) </code></pre>
<pre class="r"><code>titanic_recipe
#&gt; Data Recipe
#&gt; 
#&gt; Inputs:
#&gt; 
#&gt;       role #variables
#&gt;         ID          1
#&gt;    outcome          1
#&gt;  predictor         10
#&gt; 
#&gt; Operations:
#&gt; 
#&gt; Delete terms Ticket, Cabin
#&gt; Dummy variables from all_nominal(), -all_outcomes()
#&gt; Zero variance filter on all_predictors()</code></pre>
</div>
<div id="define-model" class="section level1">
<h1>Define model</h1>
<pre class="r"><code>lr_mod &lt;- 
  logistic_reg() %&gt;% 
  set_engine(&quot;glm&quot;) %&gt;% 
  set_mode(&quot;classification&quot;)</code></pre>
<pre class="r"><code>lr_mod
#&gt; Logistic Regression Model Specification (classification)
#&gt; 
#&gt; Computational engine: glm</code></pre>
</div>
<div id="define-modelling-workflow" class="section level1">
<h1>Define modelling workflow</h1>
<pre class="r"><code>titanic_wf1 &lt;-
  workflow() %&gt;% 
  add_model(lr_mod) %&gt;% 
  add_recipe(titanic_recipe)</code></pre>
<pre class="r"><code>titanic_wf1
#&gt; ══ Workflow ════════════════════════════════════════════════════════════════════
#&gt; Preprocessor: Recipe
#&gt; Model: logistic_reg()
#&gt; 
#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────
#&gt; 3 Recipe Steps
#&gt; 
#&gt; ● step_rm()
#&gt; ● step_dummy()
#&gt; ● step_zv()
#&gt; 
#&gt; ── Model ───────────────────────────────────────────────────────────────────────
#&gt; Logistic Regression Model Specification (classification)
#&gt; 
#&gt; Computational engine: glm</code></pre>
</div>
<div id="fit-model" class="section level1">
<h1>Fit model</h1>
<pre class="r"><code>titanic_fit_lr &lt;-
  titanic_wf1 %&gt;% 
  fit(data = train)</code></pre>
<p>Model performance on <em>train</em> data:</p>
<pre class="r"><code>titanic_fit_lr %&gt;% 
  pull_workflow_fit() %&gt;% 
  tidy()
#&gt; # A tibble: 900 x 5
#&gt;    term                                   estimate std.error   statistic p.value
#&gt;    &lt;chr&gt;                                     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;
#&gt;  1 (Intercept)                          -37.3       1384525.    -2.69e-5    1.00
#&gt;  2 PassengerId                           -0.000141      773.    -1.83e-7    1.00
#&gt;  3 Pclass                                 2.26       686403.     3.29e-6    1.00
#&gt;  4 Age                                    0.0159      28739.     5.52e-7    1.00
#&gt;  5 SibSp                                 -2.78       914743.    -3.04e-6    1.00
#&gt;  6 Parch                                -20.0       1101293.    -1.81e-5    1.00
#&gt;  7 Fare                                   0.450       10009.     4.50e-5    1.00
#&gt;  8 Name_Abbott..Mr..Rossmore.Edward      17.4       1274978.     1.37e-5    1.00
#&gt;  9 Name_Abbott..Mrs..Stanton..Rosa.Hun…  70.2        885452.     7.93e-5    1.00
#&gt; 10 Name_Abelson..Mr..Samuel              -2.26      1122039.    -2.01e-6    1.00
#&gt; # … with 890 more rows</code></pre>
<pre class="r"><code>titanic_fit_lr %&gt;% 
  pull_workflow_fit() %&gt;% 
  glance()
#&gt; # A tibble: 1 x 8
#&gt;   null.deviance df.null   logLik   AIC   BIC      deviance df.residual  nobs
#&gt;           &lt;dbl&gt;   &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1          961.     711 -2.07e-9 1424. 4676. 0.00000000413           0   712</code></pre>
</div>
<div id="predict" class="section level1">
<h1>Predict</h1>
<pre class="r"><code>test &lt;-
  test %&gt;% 
  bind_cols(predict(titanic_fit_lr, test, type = &quot;class&quot;))</code></pre>
</div>
<div id="reproducibility" class="section level1">
<h1>Reproducibility</h1>
<pre><code>#&gt; ─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────
#&gt;  setting  value                       
#&gt;  version  R version 4.0.2 (2020-06-22)
#&gt;  os       macOS Catalina 10.15.7      
#&gt;  system   x86_64, darwin17.0          
#&gt;  ui       X11                         
#&gt;  language (EN)                        
#&gt;  collate  en_US.UTF-8                 
#&gt;  ctype    en_US.UTF-8                 
#&gt;  tz       Europe/Berlin               
#&gt;  date     2020-12-08                  
#&gt; 
#&gt; ─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────
#&gt;  package     * version date       lib source        
#&gt;  assertthat    0.2.1   2019-03-21 [1] CRAN (R 4.0.0)
#&gt;  backports     1.2.0   2020-11-02 [1] CRAN (R 4.0.2)
#&gt;  blogdown      0.21    2020-10-11 [1] CRAN (R 4.0.2)
#&gt;  bookdown      0.21    2020-10-13 [1] CRAN (R 4.0.2)
#&gt;  broom         0.7.2   2020-10-20 [1] CRAN (R 4.0.2)
#&gt;  callr         3.5.1   2020-10-13 [1] CRAN (R 4.0.2)
#&gt;  cellranger    1.1.0   2016-07-27 [1] CRAN (R 4.0.0)
#&gt;  cli           2.2.0   2020-11-20 [1] CRAN (R 4.0.2)
#&gt;  codetools     0.2-16  2018-12-24 [2] CRAN (R 4.0.2)
#&gt;  colorspace    2.0-0   2020-11-11 [1] CRAN (R 4.0.2)
#&gt;  crayon        1.3.4   2017-09-16 [1] CRAN (R 4.0.0)
#&gt;  DBI           1.1.0   2019-12-15 [1] CRAN (R 4.0.0)
#&gt;  dbplyr        2.0.0   2020-11-03 [1] CRAN (R 4.0.2)
#&gt;  desc          1.2.0   2018-05-01 [1] CRAN (R 4.0.0)
#&gt;  devtools      2.3.2   2020-09-18 [1] CRAN (R 4.0.2)
#&gt;  digest        0.6.27  2020-10-24 [1] CRAN (R 4.0.2)
#&gt;  dplyr       * 1.0.2   2020-08-18 [1] CRAN (R 4.0.2)
#&gt;  ellipsis      0.3.1   2020-05-15 [1] CRAN (R 4.0.0)
#&gt;  evaluate      0.14    2019-05-28 [1] CRAN (R 4.0.0)
#&gt;  fansi         0.4.1   2020-01-08 [1] CRAN (R 4.0.0)
#&gt;  forcats     * 0.5.0   2020-03-01 [1] CRAN (R 4.0.0)
#&gt;  fs            1.5.0   2020-07-31 [1] CRAN (R 4.0.2)
#&gt;  generics      0.1.0   2020-10-31 [1] CRAN (R 4.0.2)
#&gt;  ggplot2     * 3.3.2   2020-06-19 [1] CRAN (R 4.0.0)
#&gt;  glue          1.4.2   2020-08-27 [1] CRAN (R 4.0.2)
#&gt;  gtable        0.3.0   2019-03-25 [1] CRAN (R 4.0.0)
#&gt;  haven         2.3.1   2020-06-01 [1] CRAN (R 4.0.0)
#&gt;  hms           0.5.3   2020-01-08 [1] CRAN (R 4.0.0)
#&gt;  htmltools     0.5.0   2020-06-16 [1] CRAN (R 4.0.0)
#&gt;  httr          1.4.2   2020-07-20 [1] CRAN (R 4.0.2)
#&gt;  jsonlite      1.7.1   2020-09-07 [1] CRAN (R 4.0.2)
#&gt;  knitr         1.30    2020-09-22 [1] CRAN (R 4.0.2)
#&gt;  lifecycle     0.2.0   2020-03-06 [1] CRAN (R 4.0.0)
#&gt;  lubridate     1.7.9.2 2020-11-13 [1] CRAN (R 4.0.2)
#&gt;  magrittr      2.0.1   2020-11-17 [1] CRAN (R 4.0.2)
#&gt;  memoise       1.1.0   2017-04-21 [1] CRAN (R 4.0.0)
#&gt;  modelr        0.1.8   2020-05-19 [1] CRAN (R 4.0.0)
#&gt;  munsell       0.5.0   2018-06-12 [1] CRAN (R 4.0.0)
#&gt;  pillar        1.4.7   2020-11-20 [1] CRAN (R 4.0.2)
#&gt;  pkgbuild      1.1.0   2020-07-13 [1] CRAN (R 4.0.2)
#&gt;  pkgconfig     2.0.3   2019-09-22 [1] CRAN (R 4.0.0)
#&gt;  pkgload       1.1.0   2020-05-29 [1] CRAN (R 4.0.0)
#&gt;  prettyunits   1.1.1   2020-01-24 [1] CRAN (R 4.0.0)
#&gt;  processx      3.4.5   2020-11-30 [1] CRAN (R 4.0.2)
#&gt;  ps            1.4.0   2020-10-07 [1] CRAN (R 4.0.2)
#&gt;  purrr       * 0.3.4   2020-04-17 [1] CRAN (R 4.0.0)
#&gt;  R6            2.5.0   2020-10-28 [1] CRAN (R 4.0.2)
#&gt;  Rcpp          1.0.5   2020-07-06 [1] CRAN (R 4.0.2)
#&gt;  readr       * 1.4.0   2020-10-05 [1] CRAN (R 4.0.2)
#&gt;  readxl        1.3.1   2019-03-13 [1] CRAN (R 4.0.0)
#&gt;  remotes       2.2.0   2020-07-21 [1] CRAN (R 4.0.2)
#&gt;  reprex        0.3.0   2019-05-16 [1] CRAN (R 4.0.0)
#&gt;  rlang         0.4.9   2020-11-26 [1] CRAN (R 4.0.2)
#&gt;  rmarkdown     2.5     2020-10-21 [1] CRAN (R 4.0.2)
#&gt;  rprojroot     2.0.2   2020-11-15 [1] CRAN (R 4.0.2)
#&gt;  rstudioapi    0.13    2020-11-12 [1] CRAN (R 4.0.2)
#&gt;  rvest         0.3.6   2020-07-25 [1] CRAN (R 4.0.2)
#&gt;  scales        1.1.1   2020-05-11 [1] CRAN (R 4.0.0)
#&gt;  sessioninfo   1.1.1   2018-11-05 [1] CRAN (R 4.0.0)
#&gt;  stringi       1.5.3   2020-09-09 [1] CRAN (R 4.0.2)
#&gt;  stringr     * 1.4.0   2019-02-10 [1] CRAN (R 4.0.0)
#&gt;  testthat      3.0.0   2020-10-31 [1] CRAN (R 4.0.2)
#&gt;  tibble      * 3.0.4   2020-10-12 [1] CRAN (R 4.0.2)
#&gt;  tidyr       * 1.1.2   2020-08-27 [1] CRAN (R 4.0.2)
#&gt;  tidyselect    1.1.0   2020-05-11 [1] CRAN (R 4.0.0)
#&gt;  tidyverse   * 1.3.0   2019-11-21 [1] CRAN (R 4.0.0)
#&gt;  usethis       1.6.3   2020-09-17 [1] CRAN (R 4.0.2)
#&gt;  vctrs         0.3.5   2020-11-17 [1] CRAN (R 4.0.2)
#&gt;  withr         2.3.0   2020-09-22 [1] CRAN (R 4.0.2)
#&gt;  xfun          0.19    2020-10-30 [1] CRAN (R 4.0.2)
#&gt;  xml2          1.3.2   2020-04-23 [1] CRAN (R 4.0.0)
#&gt;  yaml          2.2.1   2020-02-01 [1] CRAN (R 4.0.0)
#&gt; 
#&gt; [1] /Users/sebastiansaueruser/Rlibs
#&gt; [2] /Library/Frameworks/R.framework/Versions/4.0/Resources/library</code></pre>
</div>
